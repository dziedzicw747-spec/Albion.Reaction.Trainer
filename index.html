<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Albion ZvZ Reaction Trainer</title>

<style>
  body {
    background: black;
    color: white;
    text-align: center;
    font-family: Arial, sans-serif;
    margin: 0;
  }

  video {
  max-width: 90vw;
  max-height: 60vh;
  width: auto;
  height: auto;
  margin-top: 20px;
  border: 2px solid white;
}


  #status {
    font-size: 28px;
    margin-top: 20px;
  }

  #bg {
    position: fixed;
    inset: 0;
    background: url("background.png") center/cover no-repeat;
    filter: blur(4px) brightness(0.4);
    z-index: -1;
  }

  #streak {
    position: fixed;
    top: 15px;
    right: 20px;
    font-size: 22px;
    font-weight: bold;
    background: rgba(0,0,0,0.6);
    padding: 8px 14px;
    border-radius: 10px;
    border: 1px solid white;
  }
</style>
</head>

<body>

<div id="bg"></div>
<div id="streak">ðŸ”¥ Streak: 0</div>

<h1>Albion ZvZ Reaction Trainer</h1>
<p>NaciÅ›nij <b>Przycisk</b> tak by uniknÄ…Ä‡ Å›mierci</p>

<video id="video" controls></video>

<div id="status">Czekamâ€¦</div>

<script>
const clips = [
  { file: "zvz1.mp4", key: "1", windowStart: 5.5, windowLength: 0.5 },
  { file: "zvz2.mp4", key: "f", windowStart: 1.0, windowLength: 0.5 },
  { file: "zvz3.mp4", key: "1", windowStart: 1.0, windowLength: 0.5 },
  { file: "zvz4.mp4", key: "1", windowStart: 1.5, windowLength: 0.4 },
  { file: "zvz4.mp4", key: "1", windowStart: 1.5, windowLength: 0.7 }
];

let order = [];
let currentIndex = 0;
let state = "waiting";
let reacted = false;

const video = document.getElementById("video");
const status = document.getElementById("status");
const streakDisplay = document.getElementById("streak");

/* STREAK */
let streak = Number(localStorage.getItem("streak")) || 0;
streakDisplay.textContent = `ðŸ”¥ Streak: ${streak}`;

/* SHUFFLE */
function shuffle(array) {
  return array
    .map(v => ({ v, r: Math.random() }))
    .sort((a, b) => a.r - b.r)
    .map(x => x.v);
}

/* START RUN */
function startRun() {
  order = shuffle([...clips]);
  currentIndex = 0;
  askReady();
}

/* READY */
function askReady() {
  state = "waiting";
  reacted = false;

  video.pause();
  video.removeAttribute("src");
  video.load();

  status.textContent = "ðŸ‘‰ JESTEÅš GOTOWY? (naciÅ›nij G)";
}

/* PLAY CLIP */
function startClip() {
  const clip = order[currentIndex];
  reacted = false;
  state = "playing";

  video.src = clip.file;
  video.load();
  video.play();

  status.textContent = `KLAWISZ: ${clip.key.toUpperCase()}`;
}

/* KEY HANDLER */
document.addEventListener("keydown", (e) => {
  const key = e.key.toLowerCase();

  if (state === "waiting" && key === "g") {
    startClip();
    return;
  }

  if (state !== "playing" || reacted) return;

  const clip = order[currentIndex];
  const time = video.currentTime;
  const windowEnd = clip.windowStart + clip.windowLength;

  if (key === clip.key) {
    reacted = true;
    state = "resolved";

    if (time >= clip.windowStart && time <= windowEnd) {
      streak++;
      localStorage.setItem("streak", streak);
      streakDisplay.textContent = `ðŸ”¥ Streak: ${streak}`;
      status.textContent = "âœ… GOOD";
    } else {
      streak = 0;
      localStorage.setItem("streak", streak);
      streakDisplay.textContent = `ðŸ”¥ Streak: ${streak}`;
      status.textContent = "âŒ FAIL";
    }
  }
});

/* VIDEO END */
video.addEventListener("ended", () => {
  if (state !== "resolved") {
    streak = 0;
    localStorage.setItem("streak", streak);
    streakDisplay.textContent = `ðŸ”¥ Streak: ${streak}`;
    status.textContent = "âŒ FAIL";
  }

  setTimeout(() => {
    if (status.textContent.includes("FAIL")) {
      askReady();
    } else {
      currentIndex++;
      if (currentIndex < order.length) {
        askReady();
      } else {
        status.textContent = "ðŸ† RUN ZAKOÅƒCZONY";
        setTimeout(startRun, 2000);
      }
    }
  }, 1200);
});

startRun();
</script>

</body>
</html>
