<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Albion ZvZ Reaction Trainer</title>

<style>
  body {
    background: black;
    color: white;
    text-align: center;
    font-family: Arial, sans-serif;
  }

  video {
    width: 80%;
    margin-top: 20px;
    border: 2px solid white;
  }

  #status {
    font-size: 28px;
    margin-top: 20px;
  }
</style>
</head>

<body>

<h1>Albion ZvZ Reaction Trainer</h1>
<p>Naci≈õnij <b>F</b> gdy gu≈õlarz dotknie ziemi</p>

<!-- VIDEO ‚Äì bez <source>, JS ustawia src -->
<video id="video" controls></video>

<div id="status">Czekam‚Ä¶</div>

<script>
const clips = [
  {
    file: "./zvz1.mp4",
    key: "f",
    windowStart: 5.5,
    windowLength: 0.5
  },
  {
    file: "./zvz2.mp4",
    key: "f",
    windowStart: 1.0,
    windowLength: 0.5
  }
];

let order = [];
let currentIndex = 0;
let state = "waiting"; // waiting | playing | resolved
let reacted = false;

const video = document.getElementById("video");
const status = document.getElementById("status");

/* LOSOWA KOLEJNO≈öƒÜ */
function shuffle(array) {
  return array
    .map(v => ({ v, r: Math.random() }))
    .sort((a, b) => a.r - b.r)
    .map(x => x.v);
}

/* START CA≈ÅEGO RUNU */
function startRun() {
  order = shuffle([...clips]);
  currentIndex = 0;
  askReady();
}

/* PYTANIE GOTOWO≈öCI */
function askReady() {
  state = "waiting";
  reacted = false;

  video.pause();
  video.removeAttribute("src");
  video.load();

  status.textContent = "üëâ JESTE≈ö GOTOWY? (naci≈õnij G)";
}

/* START KLIPU */
function startClip() {
  const clip = order[currentIndex];
  reacted = false;
  state = "playing";

  video.src = clip.file;
  video.load();
  video.play();

  status.textContent = `KLAWISZ: ${clip.key.toUpperCase()}`;
}

/* OBS≈ÅUGA KLAWISZY */
document.addEventListener("keydown", (e) => {
  const key = e.key.toLowerCase();

  if (state === "waiting" && key === "g") {
    startClip();
    return;
  }

  if (state !== "playing" || reacted) return;

  const clip = order[currentIndex];
  const time = video.currentTime;
  const windowEnd = clip.windowStart + clip.windowLength;

  if (key === clip.key) {
    reacted = true;
    state = "resolved";

    if (time >= clip.windowStart && time <= windowEnd) {
      status.textContent = "‚úÖ GOOD";
    } else {
      status.textContent = "‚ùå FAIL";
    }
  }
});

/* KONIEC WIDEO */
video.addEventListener("ended", () => {
  if (state !== "resolved") {
    status.textContent = "‚ùå FAIL";
  }

  setTimeout(() => {
    if (status.textContent.includes("FAIL")) {
      askReady(); // powt√≥rz ten sam
    } else {
      currentIndex++;
      if (currentIndex < order.length) {
        askReady();
      } else {
        status.textContent = "üèÜ RUN ZAKO≈ÉCZONY";
        setTimeout(startRun, 2000);
      }
    }
  }, 1200);
});

startRun();
</script>

</body>
</html>
